<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
		<title>Accuweather Toolbar</title>
		<script src="js/global.js" type="text/javascript"></script>	
        <link href="css/global.css" type="text/css" rel="stylesheet" />
		<link href="css/index.css" type="text/css" rel="stylesheet" />
        <script type="text/javascript">
                            var currentLoc;
							var farencelc;
							var TARGET = "#_tab";
                            //var loclist = readCookie("locList<?php $locale ?>");
                            $(document).ready(function() {
							
								farencelc = "0";
								getLocInfo();
								setInterval ( "getLocInfo()", 5000 );
								
							});
							function EBGlobalKeyChanged (key, value) 
								{	
									getLocInfo();
								}
                            function openSearchGadget() {
								<?php define("HOST", 'http://' . $_SERVER['HTTP_HOST'] . dirname($_SERVER['PHP_SELF']) . '/'); ?>
								var APP_PATH = "<?php print HOST; ?>";
								var h = 314;
								var w = 300;
								var features = "savelocation=0,openposition=offset:(0;28),closeonexternalclick=yes,saveresizedsize=no,titlebar=no,closebutton=no,resizable=no,hscroll=no,vscroll=no";
								if ($.browser.msie) {
									h += 40;
								} else if (!$.browser.mozilla) {
									h += 17;
								}
								OpenGadget(APP_PATH + 'aweathergad.php', w, h, features);
							} 
							 function openCelciusGadget() {
								<?php define("HOST", 'http://' . $_SERVER['HTTP_HOST'] . dirname($_SERVER['PHP_SELF']) . '/'); ?>
								var APP_PATH = "<?php print HOST; ?>";
								var h = 34;
								var w = 64;
								var features = "savelocation=0,openposition=offset:(550;28),closeonexternalclick=yes,saveresizedsize=no,titlebar=no,closebutton=yes,resizable=no,hscroll=no,vscroll=no";
								if ($.browser.msie) {
									h += 40;
								} else if (!$.browser.mozilla) {
									h += 17;
								}
								OpenGadget(APP_PATH + 'metricgad.html', w, h, features);
							} 
							function redirect(url)
							{
									setTimeout(function() { window.location.href = url + TARGET; }, 200);
							}
                            function getLocInfo()
                            {	currentLoc = "";
								farencelc = "";
								farencelc = RetrieveGlobalKey('farencelc');	
								
								currentLoc = RetrieveGlobalKey('selectedLocation');
								if (currentLoc == null || currentLoc == '') {
									currentLoc = '';
								}
								if (farencelc == null || farencelc == '') {
									farencelc = '0';
								}

                               $.ajax({ type:"GET", url: "proxy.php?loc=" + currentLoc + "&metric=" + farencelc, dataType: "xml", success: parseXML });
                            
                                function parseXML(xml)
                                {
									var metric = "&#176;" + $(xml).find("units").find("temp").text();
									var daylight;
									var toolTip;
									var redirectUrl;
                                   	$(xml).find("local").each(function()
										{
											var text = "";
											var Country = "";
											 text = $(xml).find("city").text();
											 Country = $(xml).find("country").text();
											$(".comp-1 .comp-wrapper .title").html(text + ", " + Country);
											$(".comp-1 .drop").click(openSearchGadget);
											$(".comp-8 .settingsicon").click(openCelciusGadget);

							
										});
									$(xml).find("currentconditions").each(function()
										{
											daylight = $(this).attr("daylight").toString();
											var icon = $(this).find("weathericon").text();
											var temp = $(this).find("temperature").text();
											tooltip = $(this).find('weathertext').text();
											redirectUrl = $(this).find("url").text();
											$(".wconditions", "#comp-2").css('background-image', 'url(images/weather/icon' + icon + '.png)');
											$(".comp-wrapper", "#comp-2").click( function() { redirect(redirectUrl); } );
											$(".comp-wrapper", "#comp-2").attr('title', tooltip);
											$(".temp", "#comp-2").html(temp + metric);
					
										});
									$(xml).find("day[number='1']").each(function()
										{
											var icon2;
											var s;
											var hightemp;
											var lowtemp;
											var hovtitle;
											if(daylight == "True")
											{	
												s = "daytime";
											}
											else
											{
												s = "nighttime";
											}
											var redirectUrl2 = "";
											redirectUrl2 = $(this).find("url").text();
											icon2 = $(this).find(s).find('weathericon').text();
											hovtitle = $(this).find(s).find('txtshort').text();
											$(".comp-wrapper", "#comp-3").click( function() { redirect(redirectUrl2); } );
											$(".ticon", "#comp-3").css('background-image', 'url(images/weather/icon' + icon2 + '.png)');
											hightemp = $(this).find(s).find("hightemperature").text();
											lowtemp = $(this).find(s).find("lowtemperature").text();
											$(".comp-wrapper", "#comp-3").attr('title', hovtitle);
											$(".temp", "#comp-3").html("H: " + hightemp + metric + " / L: " + lowtemp + metric);
										});
									$(xml).find("day[number='2']").each(function()
										{
											var icon3;
											var t;
											var hightemp;
											var lowtemp;
											if(daylight == "True")
											{	
												t = "daytime";
											}
											else
											{
												t = "nighttime";
											}
											var redirectUrl3 = "";
											hovtitle = "";
											redirectUrl3 = $(this).find("url").text();
											icon3 = $(this).find(t).find('weathericon').text();
											hovtitle = $(this).find(t).find('txtshort').text();
											hightemp = $(this).find(t).find("hightemperature").text();
											lowtemp = $(this).find(t).find("lowtemperature").text();
											$(".tomicon", "#comp-4").css('background-image', 'url(images/weather/icon' + icon3 + '.png)');
											$(".comp-wrapper", "#comp-4").click( function() { redirect(redirectUrl3); } );
											$(".comp-wrapper", "#comp-4").attr('title', hovtitle);
											$(".temp", "#comp-4").html("H: " + hightemp + metric + " / L: " + lowtemp + metric);
										});
										$(xml).find("hourly").each(function()
										{
											
											var redirectUrl4 = "";
											hovtitle = "";
											redirectUrl4 = $(this).find("traditionalLink").text();
											
											hovtitle = "hourly";
											
											
											$(".comp-wrapper", "#comp-5").click( function() { redirect(redirectUrl4); } );
											$(".comp-wrapper", "#comp-5").attr('title', hovtitle);
										
										});
										$(xml).find("day[number='3']").each(function()
										{
											
											t="";
										
											if(daylight == "True")
											{	
												t = "daytime";
											}
											else
											{
												t = "nighttime";
											}
											var redirectUrl5 = "";
											hovtitle = "";
											redirectUrl5 = $(this).find("url").text();
											
											hovtitle = "15 days";
						
											
											$(".comp-wrapper", "#comp-6").click( function() { redirect(redirectUrl5); } );
											$(".comp-wrapper", "#comp-6").attr('title', hovtitle);
									
										});
										/*	var containerWidth = "";
											containerWidth = $("#comp-1").width();
											containerWidth = containerWidth + $("#comp-2").width();
											containerWidth = containerWidth + $("#comp-3").width();
											containerWidth = containerWidth + $("#comp-4").width();
											containerWidth = containerWidth + $("#comp-5").width();
											containerWidth = containerWidth + $("#comp-6").width();
											containerWidth = containerWidth + $("#comp-8").width();
											setTimeout(function() {
											$(".toolbar").css(width, containerwidth);
											}, 200);	*/
											
											
									}
                            }
                           
    </script>
	</head>
	<body>
		<div class="toolbar">
				<div class="toolbar-wrapper">
				<div class="comp comp-1" id="comp-1" title="">
				<div class="comp-wrapper">
					<div class="title"></div>
					<div class="drop"></div>
				</div>
				</div>
				<div class="comp comp-2" id="comp-2">
					<div class="comp-wrapper" title="">
					<div class="title">Now:</div>
					<div class="wconditions">
						<div class="nalert"></div>
					</div>
					<div class="temp">N\A</div>
					<div class="spacer"></div>
					</div>
				</div>
				<div class="comp comp-3" id="comp-3">
					<div class="comp-wrapper" title="" >
						<div class="title">Today:</div>
					<div class="ticon">
						<div class="talert"></div>
					</div>
					<div class="temp">N\A</div>
					<div class="spacer"></div>
					</div>
				</div>
				<div class="comp comp-4" id="comp-4">
					<div class="comp-wrapper">
					<div class="title">Tom:</div>
					<div class="tomicon">
						<div class="tomalert"></div>
					</div>
					<div class="temp">N\A</div>
					<div class="spacer"></div>
					</div>
				</div>
				<div class="comp comp-5" id="comp-5">
					<div class="comp-wrapper">
						<div class="hicon"></div>
					</div>
				</div>
				<div class="comp comp-6" id="comp-6">
					<div class="comp-wrapper">
						<div class="fdicon"></div>
					</div>
					<div class="spacer"></div>
				</div>
				<div class="comp comp-8" id="comp-8">
					<div class="comp-wrapper">
						<div class="settingsicon"></div>
					</div>
				</div>
			</div>
			</div>
		</div>
	</body>
</html>
